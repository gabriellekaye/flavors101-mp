<html>
    <head>
        <title>Recipe</title>
        <link rel = "stylesheet" type = "text/css" media="all" href = "../public/css/style_post.css"/>
        <script src="https://kit.fontawesome.com/38d688374b.js" crossorigin="anonymous"></script>
        <link rel = "stylesheet" type = "text/css" media="all" href = "../public/css/comment.css"/>
        <script type="text/javascript" src="/public/javascript/comment.js"></script>  

    </head>
    
    <body>
        {{> nav }}
        {{#with recipe}}
            <div class = "post" style="background-color: white;">
                <h1 class = "name">{{{parseMarkdown title}}}</h1>                
                <h3 class = "author">By: <a href = "/profile/{{author}}">{{author}}</a><br><br></h3>
                <div class = "button_cont">

                    <form action = "/like/{{_id}}" method = "POST">
                        <input type = "submit" class = "like_b" value = "👍 Like"/>   
                    </form>
                </div> <br>
                <div class = "button_cont">

                    <form action = "/unlike/{{_id}}" method = "POST">
                        <input type = "submit" class = "unlike_b" value = "Unlike"/>   
                    </form>

                    <h2>Liked by: <span id = "count">{{likes}}</span></h2>
                    <h2>Average Rating: <span id = "count">{{average}}</span></h2>
                </div>
        
                <br>
                <br>
                
                <div class = "c_i">
                    <img class = "image" src = "../public/uploads/{{image}}"/>
                    <br>
                </div>
                
                
                <p class = "desc">{{{parseMarkdown description}}}</p>

                <hr>
                <br>
                
                <h1 class = "h_ingredients">Ingredients</h1>
                <ul class = "ingredients">
                    {{#each ingredients}}
                        <li>
                            {{{parseMarkdown this}}}
                        </li>
                    {{/each}}
                </ul>

                <hr>
                <br>

                <h1 class = "h_prep">Preparation</h1>
                
                <ol class = "prep">
                    {{#each preparation}}
                        <li>
                            {{{parseMarkdown this}}}
                        </li>
                    {{/each}}
                </ol>
                <hr>
            </div>
            <br>
            {{!-- UPDATE BUTTON --}}
            <form action = "/update/{{_id}}" method = "GET">
                <input type = "submit" class = 'updateBtn' value = "UPDATE"/>
            </form>
            <br>
            <br>
            
            {{!-- DELETE BUTTON --}}
            
            {{!-- <button type="button" id = "deleteBtn" class = "delete" data-doc = {{_id}}>DELETE</button> --}}
            <form action = "/delete/{{_id}}" method = "POST">
                <input type = "submit" class = 'deleteBtn' value = "DELETE"/>
            </form>

            <br>

            {{!-- COMMENTS --}}
            <div id="page">
                <h2 id="rate">Comments:</h2><br><br>
                {{#each comments}}
                   <div id="new">
                        <p id="my_new_cmt">{{this.text}}  (by: {{ this.user_id.username }}) Liked by: {{this.likes}}</p>

                        <div id="buttons">
                            {{#if (isEqual ../../session._id this.user_id._id)}} 
                            <form action = "/{{this.recipe}}/delete-comment" method = "POST">
                                <input type='hidden' name= "comment" id="cmt-id" value='{{this._id}}'>
                                <input type = "submit" id="delete" class = 'deleteBtn' value = "DELETE"/>
                            </form> 
                            <br>
                            <form action = "/{{this.recipe}}/edit" method = "POST">
                                <input type='hidden' name= "id" id="cmt-id" value='{{this._id}}'>
                                <input type = "submit" id="edit" class = 'updateBtn' value = "UPDATE"/>
                            </form>
                            <br>
                            {{!-- Like Button --}}
                            <form action = "/{{this.recipe}}/like-comment" method = "POST">
                                <input type='hidden' name= "id" id="cmt-id" value='{{this._id}}'>
                                <input type = "submit" id="like" class = 'likeBtn' value = "LIKE"/>
                            </form>
                        {{/if}}

                        </div>
                        
                        <p id = "my_new_cmt">Replies: </p>
                        {{#each replies}}
                            <p id="my_new_cmt">{{this.text}} (by: {{ this.user_id.username }})</p>
                            {{#if (isEqual ../../../session._id this.user_id._id)}} 
                                <form action = "/{{this.recipe}}/delete-comment" method = "POST">
                                    <input type='hidden' name= "comment" id="cmt-id" value='{{this._id}}'>
                                    <input type = "submit" id="delete" class = 'deleteBtn' value = "DELETE"/>
                                </form> 
                                <br>
                                <form action = "/{{this.recipe}}/edit" method = "POST">
                                    <input type='hidden' name= "id" id="cmt-id" value='{{this._id}}'>
                                    <input type = "submit" id="edit" class = 'updateBtn' value = "UPDATE"/>
                                </form>
                                <br>
                                {{!-- Like Button --}}
                                <form action = "/{{this.recipe}}/like-comment" method = "POST">
                                    <input type='hidden' name= "id" id="cmt-id" value='{{this._id}}'>
                                    <input type = "submit" id="like" class = 'likeBtn' value = "LIKE"/>
                                </form>
                            {{/if}}
                        {{/each}}


                        
                        <form action="/comment/{{this.recipe}}" method="POST">
                            <input type="hidden" name="reply_to" id="reply_to" value="{{this._id}}">
                            <textarea id="comments" name = "comment" placeholder="Reply..." rows="5" cols="80" name="comment" maxlength="500" required></textarea>
                            <input type = "submit" value = "Post Reply"/>
                        </form>
                        
                    </div>
                
                {{else}}
                    <p id="comment">No Comments</p>
                {{/each}}
            
                <div>
                    <form action = "/comment/{{_id}}" method = "POST">
                        <br><br>
                        <textarea id="comments" name = "comment" placeholder="Comment about this recipe..." rows="5" cols="80" name="comment" maxlength="500" required></textarea>
                        <br>
                        {{!-- <button id="btn_cmt" onclick="post_cmt(this);">Post Comment</button> --}}
                        <input type = "submit" value = "Post Comment"/>
                    </form>

                    <br><br><br>
                    {{!-- RATE --}}
                    <h2 id="rate">Rate this recipe by taste and difficulty:</h2>
                    <br>
                    <div class="rate">
                        <form action = "/rate/{{_id}}" method="POST" class = rate>
                            <input type="radio" id="star5" name="rate" value="5" />
                            <label for="star5" title="5 stars">5 stars</label>
                            <input type="radio" id="star4" name="rate" value="4" />
                            <label for="star4" title="4 stars">4 stars</label>
                            <input type="radio" id="star3" name="rate" value="3" />
                            <label for="star3" title="3 stars">3 stars</label>
                            <input type="radio" id="star2" name="rate" value="2" />
                            <label for="star2" title="2 stars">2 stars</label>
                            <input type="radio" id="star1" name="rate" value="1" />
                            <label for="star1" title="1 star">1 star</label>
                            
                            <button type = "submit" value = "Rate">Rate</button>
                        </form>
                        <br><br><br>
                    </div>
                </div>
            </div>
        {{/with}}
    </body>
</html>